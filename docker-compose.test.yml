version: "3.7"
services:
  app-test:
    build: .
    depends_on:
      - db-test
    volumes:
      - ./config.py:/srv/audeeo/config.py
      - ./audeeo:/srv/audeeo/audeeo
      - ./tests:/srv/audeeo/tests
    environment:
      FLASK_SECRET_KEY: "ohphisai5lohTha"
    environment:
      DATABASE_URL: "postgresql://postgres:postgres@db-test/postgres"
      APP_SETTINGS: "config.TestingConfig"
    networks:
      - test
    command: ["wait-for-it", "db-test:5432", "--timeout=30", "--strict", "--",
              "flask", "test"]

  db-test:
    image: "postgres:11.2"
    networks:
      - test

networks:
  test:
    name: test
